@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Source+Serif+4:opsz,wght@8..60,400;8..60,600;8..60,700&display=swap');

@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  /* iOS Safe Area Variables - use env() with fallback */
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-left: env(safe-area-inset-left, 0px);
  --safe-right: env(safe-area-inset-right, 0px);
  
  /* Layout Constants - will be updated by JS */
  --mobile-tab-bar-h: 80px;
  --tab-bar-h: var(--mobile-tab-bar-h);
  --purchaser-inputbar-h: 88px;
  --input-bar-h: var(--purchaser-inputbar-h);
  
  /* Visual Viewport tracking (set by JS) */
  --vvh: 100vh;
  --vv-offset: 0px;
  
  --radius-xs: 6px;
  --radius-sm: 10px;
  --radius-md: 14px;
  --radius-lg: 18px;
  
  --space-1: 4px;
  --space-2: 8px;
  --space-3: 12px;
  --space-4: 16px;
  --space-6: 24px;
  --space-8: 32px;
  --space-10: 40px;
  --space-12: 48px;
  --space-16: 64px;
  
  --shadow-1: 0 1px 2px rgba(0,0,0,.06), 0 1px 1px rgba(0,0,0,.03);
  --shadow-2: 0 8px 24px rgba(0,0,0,.12);
  --shadow-3: 0 16px 48px rgba(0,0,0,.16);
  
  --z-base: 0;
  --z-dropdown: 1000;
  --z-sticky: 1020;
  --z-fixed: 1030;
  --z-modal-backdrop: 1040;
  --z-modal: 1050;
  --z-popover: 1060;
  --z-tooltip: 1070;
  
  --duration-fast: 150ms;
  --duration-base: 250ms;
  --duration-slow: 350ms;
  --duration-premium: 300ms;
  
  --ease-in: cubic-bezier(0.4, 0, 1, 1);
  --ease-out: cubic-bezier(0, 0, 0.2, 1);
  --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
  --ease-spring: cubic-bezier(0.2, 0.8, 0.2, 1);
  --ease-premium: cubic-bezier(0.16, 1, 0.3, 1);
  
  --color-gold: #D4AF37;
  --color-gold-rgb: 212, 175, 55;
  --color-black: #000000;
  --color-white: #FFFFFF;
  --color-accent: #C9A961;
  --color-accent-rgb: 201, 169, 97;
  
  --gold-50: #FEFCE8;
  --gold-100: #FEF9C3;
  --gold-200: #FEF08A;
  --gold-300: #FDE047;
  --gold-400: #FACC15;
  --gold-500: #D4AF37;
  --gold-600: #C9A961;
  --gold-700: #B8934C;
  --gold-800: #A67C3A;
  --gold-900: #8B6428;
  --gold-950: #6B4E1C;
  
  --brand-50: var(--gold-50);
  --brand-100: var(--gold-100);
  --brand-200: var(--gold-200);
  --brand-300: var(--gold-300);
  --brand-400: var(--gold-400);
  --brand-500: var(--gold-500);
  --brand-600: var(--gold-600);
  --brand-700: var(--gold-700);
  --brand-800: var(--gold-800);
  --brand-900: var(--gold-900);
  --brand-950: var(--gold-950);
  --brand-contrast: var(--color-black);
  
  --accent: var(--color-accent);
  --ring: 0 0 0 2px color-mix(in oklab, var(--brand-600) 40%, white 0%);
  
  --bg: #ffffff;
  --surface-1: #f9fafb;
  --surface-2: #f3f4f6;
  --surface-3: #e5e7eb;
  --text-1: #111827;
  --text-2: #6b7280;
  --text-3: #9ca3af;
  --muted: #d1d5db;
  --border: #e5e7eb;
  --border-strong: #d1d5db;
  --hover-bg: #f9fafb;
  --hover-bg-strong: #f3f4f6;
}

[data-theme="dark"] {
  --bg: #0b0c0f;
  --surface-1: #0f1115;
  --surface-2: #12151b;
  --surface-3: #161a22;
  --text-1: #eef2f8;
  --text-2: #9ca8bc;
  --text-3: #778199;
  --muted: #4b5563;
  --border: #1e2531;
  --border-strong: #374151;
  --hover-bg: #12151b;
  --hover-bg-strong: #161a22;
  --ring: 0 0 0 2px color-mix(in oklab, var(--brand-500) 40%, transparent 0%);
  --shadow-1: 0 1px 2px rgba(0,0,0,.24), 0 1px 1px rgba(0,0,0,.12);
  --shadow-2: 0 8px 24px rgba(0,0,0,.36);
  --shadow-3: 0 16px 48px rgba(0,0,0,.48);
}

@media (prefers-color-scheme: dark) {
  :root:not([data-theme]) {
    --bg: #0b0c0f;
    --surface-1: #0f1115;
    --surface-2: #12151b;
    --surface-3: #161a22;
    --text-1: #eef2f8;
    --text-2: #9ca8bc;
    --text-3: #778199;
    --muted: #4b5563;
    --border: #1e2531;
    --border-strong: #374151;
    --hover-bg: #12151b;
    --hover-bg-strong: #161a22;
    --ring: 0 0 0 2px color-mix(in oklab, var(--brand-500) 40%, transparent 0%);
    --shadow-1: 0 1px 2px rgba(0,0,0,.24), 0 1px 1px rgba(0,0,0,.12);
    --shadow-2: 0 8px 24px rgba(0,0,0,.36);
    --shadow-3: 0 16px 48px rgba(0,0,0,.48);
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-bg text-text-1;
    font-feature-settings: 'rlig' 1, 'calt' 1;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
}

@layer utilities {
  /* Hide scrollbar but keep scroll functionality */
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }

  .gold-shimmer {
    background: linear-gradient(
      90deg,
      transparent,
      rgba(var(--color-gold-rgb), 0.15) 50%,
      transparent
    );
    background-size: 200% 100%;
    animation: shimmer 2s ease-in-out infinite;
  }

  @keyframes shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
  }

  .gold-glow {
    animation: glow 2s ease-in-out infinite alternate;
  }

  @keyframes glow {
    from {
      box-shadow: 0 0 10px rgba(var(--color-gold-rgb), 0.2);
    }
    to {
      box-shadow: 0 0 20px rgba(var(--color-gold-rgb), 0.4), 0 0 30px rgba(var(--color-gold-rgb), 0.2);
    }
  }

  .hover-lift {
    transition: transform var(--duration-premium) var(--ease-premium), box-shadow var(--duration-premium) var(--ease-premium);
  }

  .hover-lift:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0, 0, 0, 0.08);
  }

  @media (prefers-reduced-motion: reduce) {
    .gold-shimmer,
    .gold-glow,
    .hover-lift,
    *[class*="animate-"] {
      animation: none !important;
      transition: none !important;
    }
    
    .hover-lift:hover {
      transform: none;
    }
  }
}

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-fadeIn {
  animation: fadeIn 0.2s ease-out forwards;
}

@media (max-width: 768px) {
  .gold-shimmer,
  .gold-glow,
  *[class*="animate-"]:not(.animate-fadeIn):not(.animate-spin):not(.animate-pulse) {
    animation: none !important;
  }
  
  .hover-lift {
    transform: none !important;
  }
  
  .hover-lift:hover {
    transform: none !important;
    box-shadow: none !important;
  }
  
  .premium-transition {
    transition-duration: 0.1s !important;
  }
  
  html {
    -webkit-text-size-adjust: 100%;
    text-size-adjust: 100%;
  }
  
  body {
    overflow-x: hidden;
    -webkit-overflow-scrolling: touch;
  }
  
  img, video {
    content-visibility: auto;
  }
}

/* ============================================
   PHASE 2: NATIVE MOBILE TOUCH INTERACTIONS
   ============================================ */

/* Remove tap highlight on all elements */
* {
  -webkit-tap-highlight-color: transparent;
}

/* Disable text selection on UI elements */
.no-select,
button,
nav,
[role="button"],
[role="tab"],
.mobile-tab-bar {
  user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}

/* Prevent iOS zoom on input focus - ensure 16px minimum */
@media (max-width: 768px) {
  input,
  textarea,
  select {
    font-size: 16px !important;
  }
}

/* Native-feel tap interaction for clickable elements */
.tap-effect {
  transition: transform 100ms ease-out, opacity 100ms ease-out;
}

.tap-effect:active {
  transform: scale(0.95);
  opacity: 0.9;
}

/* Mobile card styling with tap effect */
.mobile-card {
  transition: transform 100ms ease-out, box-shadow 150ms ease-out;
}

.mobile-card:active {
  transform: scale(0.98);
}

/* Safe area padding for notch/home bar */
.safe-area-top {
  padding-top: env(safe-area-inset-top);
}

.safe-area-bottom {
  padding-bottom: env(safe-area-inset-bottom);
}

.safe-area-left {
  padding-left: env(safe-area-inset-left);
}

.safe-area-right {
  padding-right: env(safe-area-inset-right);
}

/* Dynamic viewport height fix for mobile browsers */
.h-dvh {
  height: 100dvh;
}

.min-h-dvh {
  min-height: 100dvh;
}

.max-h-dvh {
  max-height: 100dvh;
}

/* Mobile-specific scrolling improvements */
@media (max-width: 768px) {
  .mobile-scroll {
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
    scroll-behavior: smooth;
  }
  
  /* Sticky input for chat */
  .mobile-sticky-input {
    position: sticky;
    bottom: 0;
    padding-bottom: calc(env(safe-area-inset-bottom) + 80px); /* Account for tab bar */
  }
  
  /* Hide desktop elements on mobile */
  .desktop-only {
    display: none !important;
  }
}

/* Show mobile-only elements */
@media (min-width: 769px) {
  .mobile-only {
    display: none !important;
  }
}

/* Smooth bottom sheet animation */
@keyframes slideUp {
  from {
    transform: translateY(100%);
  }
  to {
    transform: translateY(0);
  }
}

@keyframes slideDown {
  from {
    transform: translateY(0);
  }
  to {
    transform: translateY(100%);
  }
}

.sheet-enter {
  animation: slideUp 300ms cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

.sheet-exit {
  animation: slideDown 250ms cubic-bezier(0.4, 0, 1, 1) forwards;
}

/* Frosted glass effect for mobile navigation */
.frosted-glass-light {
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
}

.frosted-glass-dark {
  background: rgba(26, 26, 26, 0.9);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
}

/* Line clamp for mobile cards */
.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* ============================================
   LANDSCAPE MODE HANDLING
   ============================================ */

/* Landscape orientation notice - only on NARROW mobile devices (iPhone-like)
   Triggers when: landscape + short height + narrow width (not tablets/desktop) */
@media (max-height: 500px) and (max-width: 932px) and (orientation: landscape) {
  .landscape-warning {
    display: flex !important;
  }
  
  .landscape-hide {
    display: none !important;
  }
}

/* Hide landscape warning in all other cases */
@media (min-height: 501px), (min-width: 933px), (orientation: portrait) {
  .landscape-warning {
    display: none !important;
  }
}

/* ============================================
   KEYBOARD-AWARE LAYOUT UTILITIES
   ============================================ */

/* When keyboard is open, use visual viewport height */
.keyboard-aware {
  height: 100dvh;
  height: var(--vvh, 100dvh);
}

/* Input bar positioning that respects keyboard */
.input-bar-fixed {
  position: fixed;
  left: 0;
  right: 0;
  z-index: 60;
  bottom: calc(var(--safe-bottom) + var(--tab-bar-h, 80px));
  transform: translateY(calc(-1 * var(--vv-offset, 0px)));
}

/* Chat scroll container that never overlaps UI */
.chat-scroll-container {
  flex: 1;
  min-height: 0;
  overflow-y: auto;
  overscroll-behavior-y: contain;
  -webkit-overflow-scrolling: touch;
  padding-bottom: calc(var(--input-bar-h, 88px) + var(--tab-bar-h, 80px) + var(--safe-bottom) + 12px);
}

/* Header with safe-area-top */
.header-safe {
  padding-top: calc(12px + var(--safe-top));
}

/* Tab bar with safe-area-bottom */
.tab-bar-safe {
  padding-bottom: calc(16px + var(--safe-bottom));
}

/* ============================================
   POINTER EVENTS SAFETY
   ============================================ */

/* Ensure all header buttons remain clickable */
.header-actions button,
.header-actions a,
.header-actions [role="button"] {
  position: relative;
  z-index: 1;
  pointer-events: auto;
}

/* Prevent accidental double-tap zoom on buttons */
@media (max-width: 768px) {
  button,
  a,
  [role="button"] {
    touch-action: manipulation;
  }
}

/* =============================================================================
   GLOBAL TEXT CONTRAST FIX - Force all light grey text to black/dark
   Only applies to light backgrounds (not dark sidebars/modals)
   ============================================================================= */

/* Override light grey text ONLY on light backgrounds (white/cream containers) */
.bg-white .text-gray-200,
.bg-white .text-gray-300,
.bg-white .text-gray-400,
.bg-gray-50 .text-gray-200,
.bg-gray-50 .text-gray-300,
.bg-gray-50 .text-gray-400,
.bg-cream .text-gray-200,
.bg-cream .text-gray-300,
.bg-cream .text-gray-400 {
  color: #374151 !important; /* gray-700 */
}

.bg-white .text-grey-200,
.bg-white .text-grey-300,
.bg-white .text-grey-400,
.bg-gray-50 .text-grey-200,
.bg-gray-50 .text-grey-300,
.bg-gray-50 .text-grey-400 {
  color: #374151 !important; /* gray-700 */
}

/* Ensure table cells have dark text (tables are on light backgrounds) */
.bg-white td, .bg-white th,
.bg-gray-50 td, .bg-gray-50 th {
  color: #1f2937; /* gray-800 */
}

/* Fix chart/graph labels if present */
.recharts-text,
.recharts-cartesian-axis-tick-value,
.recharts-legend-item-text {
  fill: #1f2937 !important;
  color: #1f2937 !important;
}


/* Ensure input placeholders are visible but distinguishable */
::placeholder {
  color: #6b7280 !important; /* gray-500 - minimum contrast */
  opacity: 1;
}

/* Fix any muted/secondary text classes */
.text-muted,
.text-secondary {
  color: #4b5563 !important; /* gray-600 */
}

/* FORCE ALL LIGHT TEXT TO BE READABLE - DO NOT REMOVE */
.text-gray-200, .text-gray-300, .text-gray-400, .text-gray-500,
.text-slate-200, .text-slate-300, .text-slate-400, .text-slate-500,
.text-neutral-200, .text-neutral-300, .text-neutral-400, .text-neutral-500,
.text-zinc-200, .text-zinc-300, .text-zinc-400, .text-zinc-500 {
  color: #1f2937 !important;
}

/* ── OpenHouse Intelligence: Force light text on dark backgrounds ── */
.scheme-intel-response,
.scheme-intel-response * {
  color: #eef2f8;
}
.scheme-intel-response th {
  color: #9ca8bc !important;
  background-color: #161a22;
  text-transform: uppercase;
  font-size: 0.75rem;
  letter-spacing: 0.05em;
  font-weight: 600;
}
.scheme-intel-response td {
  color: #eef2f8 !important;
}
.scheme-intel-response table {
  border-collapse: collapse;
  width: 100%;
}
.scheme-intel-response tr {
  border-bottom: 1px solid #1e2531;
}
.scheme-intel-response tr:hover {
  background-color: rgba(30, 37, 49, 0.5);
}

/* Recharts overrides for dark developer dashboard */
.scheme-intel-response text,
.scheme-intel-response tspan,
.scheme-intel-response .recharts-cartesian-axis-tick-value,
.scheme-intel-response .recharts-legend-item-text,
.scheme-intel-response .recharts-tooltip-item,
.scheme-intel-response .recharts-label {
  fill: #9ca8bc !important;
  color: #9ca8bc !important;
}
.scheme-intel-response .recharts-tooltip-wrapper * {
  color: #eef2f8 !important;
}

