You are working in the **PropertyAssistant** monorepo on Replit.

Goal: **Fix the mobile purchaser chat layout properly.** Two explicit requirements:

1. **Home screen (no messages yet)**

   * Must look exactly like the current hero state (logo + title + 4 quick buttons).
   * Must NOT scroll on mobile.
   * The text input box must always be visible and sit directly above the bottom toolbar.
   * The bottom toolbar must never cover or overlap the input.

2. **Conversation state (after sending a message)**

   * As soon as the user sends a question, the messages view must auto-scroll so that:

     * The most recent user message and the assistant response are visible without manual scrolling.
   * The input box must remain visible and sit directly above the bottom toolbar.
   * There must be no large white gaps between the last message and the input, and no need to scroll either up or down just to see the last exchange plus the text box.

These fixes are **mobile-only**. Desktop / larger breakpoints must keep their existing layout.

---

## FILES / STRUCTURE

From this repo, you will need to work with:

* `apps/unified-portal/app/homes/[unitUid]/page.tsx`
  (purchaser shell with tabs including Chat, Map, News, Docs and the MobileTabBar)

* `apps/unified-portal/components/purchaser/PurchaserChatTab.tsx`
  (chat tab: hero state + conversation state + input)

* `apps/unified-portal/components/purchaser/MobileTabBar.tsx` (or similarly named)

Do not change developer dashboards or non-purchaser layouts.

---

## TASK 1 – MAKE A CLEAN FLEX LAYOUT FOR MOBILE CHAT

In the purchaser “homes” page (`app/homes/[unitUid]/page.tsx`):

1. Ensure the **outer container for the tab content** on mobile is a full-height flex column, for example:

```tsx
<div className="flex flex-col h-dvh md:h-auto">
  {/* header / logo bar stays as is */}
  {/* tab content area */}
  {/* MobileTabBar fixed at bottom */}
</div>
```

2. The **tab content wrapper** that contains the chat tab should on mobile:

* Use `flex-1` to fill the remaining space between the header and the bottom toolbar.
* Use `overflow-hidden` at this level to prevent the home screen from scrolling.

Example:

```tsx
<div className="flex-1 overflow-hidden md:overflow-auto">
  <PurchaserTabs ... />
</div>
```

3. Make sure the `MobileTabBar` remains fixed at the very bottom:

```tsx
<MobileTabBar className="fixed bottom-0 left-0 right-0 h-16 md:static" />
```

(Adjust `h-16` to the actual height if different.)

Do not reintroduce extra `pb-20` padding that pushes content away from the bottom; we will handle spacing inside the chat tab.

---

## TASK 2 – STRUCTURE THE CHAT TAB CORRECTLY

In `PurchaserChatTab.tsx`, restructure the component specifically for mobile:

1. Wrap the whole chat tab in a flex column container that fills the available height:

```tsx
const PurchaserChatTab = () => {
  const isMobile = useIsMobile(); // or infer from tailwind classes / window.innerWidth if a hook exists

  if (!isMobile) {
    // keep existing desktop/tablet behaviour
    return <ExistingDesktopChatLayout />;
  }

  return (
    <div className="flex h-full flex-col">
      {/* Top "body" area: hero OR messages list */}
      <div className="flex-1 overflow-hidden">
        {hasMessages ? <MessagesArea /> : <ChatHomeHero />}
      </div>

      {/* Bottom: input sitting above tab bar */}
      <ChatInputBar />
    </div>
  );
};
```

2. **Do NOT change the visual content of `ChatHomeHero`.**
   Only adjust its container so it is centered within the available vertical space:

```tsx
const ChatHomeHero = () => (
  <div className="flex h-full flex-col items-center justify-center px-4 text-center">
    {/* existing logo, title, subtitle, 4 buttons – leave as is */}
  </div>
);
```

This ensures the hero looks like the second screenshot and does not scroll because its parent `div` is `overflow-hidden`.

---

## TASK 3 – INPUT BAR ABOVE BOTTOM TOOLBAR (MOBILE ONLY)

Still in `PurchaserChatTab.tsx`:

1. Implement `ChatInputBar` so the input **always sits above** the bottom toolbar on mobile:

```tsx
const CHAT_INPUT_HEIGHT = 64;   // adjust to match actual; about h-16
const TAB_BAR_HEIGHT = 64;      // height of MobileTabBar (h-16)

const ChatInputBar = () => (
  <div
    className="relative z-20 bg-white px-4 pb-[env(safe-area-inset-bottom,0)] pt-2 border-t md:static"
    style={{ minHeight: CHAT_INPUT_HEIGHT }}
  >
    <ChatInputComponent />
    {/* spacer to account for the TabBar which is fixed behind */}
    <div className="h-16 md:hidden" /> {/* match TAB_BAR_HEIGHT */}
  </div>
);
```

Key points:

* The real input sits in this component.
* The `h-16` spacer ensures the input bar ends **above** the fixed `MobileTabBar` with a tight gap.
* Remove any old `pb-16`, `pb-20`, or similar bottom padding in this component and on the parent page that were previously used to hack spacing.

On desktop (`md:` and above), keep the previous layout (no fixed MobileTabBar underneath), so guard mobile-only classes with `md:` as shown.

---

## TASK 4 – MAKE THE MESSAGES VIEW SCROLL CORRECTLY

In the same file, create a dedicated messages container:

```tsx
const MessagesArea = () => {
  const containerRef = useRef<HTMLDivElement | null>(null);
  const messages = usePurchaserMessages(); // whatever hook you already use

  // Scroll to bottom whenever messages change
  useEffect(() => {
    const el = containerRef.current;
    if (!el) return;
    el.scrollTo({ top: el.scrollHeight, behavior: 'smooth' });
  }, [messages.length]);

  return (
    <div
      ref={containerRef}
      className="flex h-full flex-col overflow-y-auto px-4 pt-4 pb-4"
    >
      {/* Render messages from oldest to newest, normal order */}
      {messages.map((m) => (
        <MessageBubble key={m.id} message={m} />
      ))}
    </div>
  );
};
```

Requirements:

* `className="flex h-full flex-col overflow-y-auto"` ensures the messages list fills the vertical space between header and input and can scroll if conversation grows long.
* The `useEffect` must run on every new message (user or assistant) and scroll to the bottom, so the newest user question and assistant reply are immediately visible.
* Do **not** add extra bottom padding here that would create a large white gap above the input; `pb-4` is enough.

This behaviour must be **mobile-only**. If the same component is shared on desktop, they can keep the same scroll-to-bottom logic; the key is that mobile should no longer require manual scroll to see the last exchange.

---

## TASK 5 – VERIFY BOTH STATES ON A REAL MOBILE VIEW

1. **Home (no messages)**

   * Open the chat tab with no messages.
   * Confirm:

     * Hero matches existing design.
     * No scrolling is possible.
     * Input is visible and sits directly above the bottom toolbar with a tight gap.

2. **After sending a question**

   * Send a question.
   * Confirm:

     * The screen immediately shows the user’s question and the assistant’s answer without any manual scrolling.
     * The input bar remains visible above the bottom toolbar.
     * There is no huge white gap between the last message and the input, and no overlap between input and toolbar.

3. Validate that:

   * Map, News, Docs tabs are not broken.
   * Desktop purchaser view still behaves as before.

Document the changes in a short comment in `PurchaserChatTab.tsx` describing that this is the **mobile chat layout fix for home and conversation spacing**.
