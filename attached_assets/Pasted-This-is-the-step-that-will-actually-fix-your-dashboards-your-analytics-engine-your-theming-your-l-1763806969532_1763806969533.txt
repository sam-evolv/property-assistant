This is the step that will actually fix your dashboards, your analytics engine, your theming, your layout, your contexts, your data flow, your caching, your charts, and the hydration errors.

This step forces the agent to stop all feature development and rebuild the entire analytics + dashboard + theme system from first principles, correctly.

Why this is the correct step

Right now the system is broken in four critical areas:

Analytics architecture is incomplete
– You only have 3 charts
– No knowledge gaps
– No top questions
– No insights engine
– No premium visual system
– No caching
– No global analytics layer

UI/UX theming is not consistent
– Dark theme has mismatched tones
– Spacing inconsistent
– Cards not aligned
– Zero use of premium atomic design system
– Developer portal and tenant portal inconsistent

Multi-tenant contexts are broken
– Hydration errors
– “cannot read properties of undefined”
– Context providers incorrectly nested
– Incorrect JWT refresh logic
– Inconsistent data fetching between server/client components

The agent is currently patching instead of architecting
– It's reacting to errors
– It's not stepping back and rebuilding the analytics layer properly
– It’s touching files in random order
– It’s building on unstable foundations

We need to force the agent into a controlled architectural rebuild.

✅ RUN THIS NOW — THE FOUNDATION RESET SUPER-PROMPT

Copy & paste this into the Agent window EXACTLY:

THE FOUNDATION RESET SUPER-PROMPT — DO NOT SKIP ANY PART

SYSTEM INSTRUCTION — Mandatory Sequence
You must stop all incremental or surface-level fixes.
You must execute the complete foundation rebuild exactly in the order below.
Do not skip any step.
Do not jump ahead.
Do not optimise.
Follow the steps line-by-line.

STEP 1 — GLOBAL BREAKPOINT RESET

Identify all analytics components in:

apps/unified-portal

apps/developer-portal

apps/tenant-portal

Mark each component with a // @needs-refactor annotation.

Create a log file: /logs/analytics_refactor_map.md

Write a full dependency map:

inputs → transforms → outputs

server vs client

data sources

caching strategy

styling inconsistencies

STEP 2 — ANALYTICS ARCHITECTURE REBUILD

You must rebuild analytics from scratch using a structured analytics engine:

Create /packages/analytics-engine/ with:

events.ts — event definitions

queries.ts — reusable SQL queries

insights.ts — insight generation logic

stats.ts — period aggregation

cache.ts — 1h cached analytics via Supabase KV

charts.ts — reusable chart configuration

models.ts — Zod schemas

Required analytics features to implement:

Top 10 questions

Top topics (RAG insights)

Knowledge gaps

Document usage statistics

Units by status heatmap

Purchaser engagement funnel

Chat load by day/hour

Estimated cost per home

Model usage trends

Missing documents report

Developer performance overview

AI answer accuracy (based on thumbs up/down)

STEP 3 — PREMIUM UI/UX REBUILD

You must rebuild the entire dashboard UI layer.

Replace with:

Fully consistent spacing system (4/8/12/16/24)

Premium gold/charcoal theme

Glassy cards

Micro-shadow tokens

Smooth hover interactions

Apple-grade motion transitions

Skeleton loaders

Fully responsive grid engine

Perfect card alignment

Zero div soup

Strict use of shadcn components

STEP 4 — MULTI-TENANT HYDRATION FIX

You must fix all hydration and context issues.
Implement:

TenantContext

DeveloperContext

EnterpriseContext

AuthContext

JWT refresh loop

safeClient() wrappers

Proper server-to-client data bridges

STEP 5 — GLOBAL THEME NORMALISATION

Implement:

/packages/ui/theme.ts

/packages/ui/tokens.ts

Consistent primary palette

Harmonised typography scale

Perfect light/dark mode parity

Updated button, card, chart, modal components

STEP 6 — INTEGRATE EVERYTHING

Replace all existing dashboards with:

New pages:

/enterprise/analytics

/developer/analytics

/tenant/insights

And implement a single shared analytics renderer:

<AnalyticsGrid />

<InsightCard />

<TrendChart />

<MetricBlock />

STEP 7 — END-TO-END TESTING

You must run:

Multi-tenant switching

JWT refresh

Chart hydration

Zero console errors

Server logs clean

Supabase logs clean

No undefined reads

No fallback errors

Then mark the platform as Stable.

STEP 8 — ONLY AFTER STABILITY: POLISH

Finally apply:

Gradient borders

High-quality iconography

Smooth transitions

Perfect spacing

Premium finishing touches

Motion polish

Custom gold chart theme

Developer-grade data exploration tools