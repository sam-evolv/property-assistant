We have a SEV-1 tenant/data regression. The app is now resolving data from the wrong org/tenant in Supabase (appears to be the “OpenHouse” org / OH-PARK dev), which has broken multi-tenant purchaser portal branding and removed/hidden units in the dashboard.

Business requirement
Revert to the previously working state:
- Primary org/tenant: “Longview Estates” (or whatever the original tenant name/id was)
- Exactly 3 developments under that tenant:
  1) Longview Park
  2) Rathard Park
  3) Rathard Lawn
- All units/residents that previously existed must be visible again in the dashboard.
- All testing stats and testing material MUST be reinstated (whatever dataset/records powered those metrics and demo content previously, excluding the OH demo account).
- The purchaser portal must resolve branding and intro per unit correctly again.

Absolute rules
- NO deletions. NO cleanup scripts. NO “remove placeholders”. No destructive operations.
- All changes must be reversible (migration/seed script, transactions).
- Do not touch RLS policies unless required to read data for admin; do not “solve” by disabling security.
- Do not keep “OpenHouse Park / OH-PARK” as a default resolution target.

PHASE 1: Identify the original “Longview Estates” tenant and ensure it exists
1) Inspect Supabase tables for tenant/org structure:
   - tenants / organisations table (and/or organisations, orgs)
   - developments table (public.developments)
   - units / homeowners / residents tables
2) Locate:
   - the tenant/org row corresponding to “Longview Estates” (original)
   - its tenant_id / organisation_id UUID
3) Confirm the 3 developments exist and belong to that tenant_id:
   - Longview Park
   - Rathard Park
   - Rathard Lawn
4) If any are missing or tenant_id is wrong, fix via an idempotent seed script:
   - ensure Longview Estates tenant exists
   - ensure 3 developments exist with correct tenant_id and correct slugs
   - ensure each has correct logo url fields (if applicable)

PHASE 2: Fix app resolution logic so it always uses the correct tenant/development set
5) Find where the app selects “current scheme / current organisation / current tenant”.
   Common failure: defaulting to the first organisation row, or preferring “OpenHouse” org.
6) Implement deterministic selection:
   - For admin dashboard: use the signed-in user’s organisation memberships (not the first org in DB).
   - For purchaser portal: resolve tenant/development strictly via unit token -> unit -> development_id -> developments.tenant_id
   - Remove any “fallback to OH-PARK” or “OpenHouse Park” defaults.
7) Add explicit guardrails:
   - If a purchaser token resolves to a unit whose development tenant does not match expected, log a structured error and still use that unit’s actual development tenant. Never jump tenants.

PHASE 3: Reinstate units/residents visibility (this is why dashboard shows 1)
8) Identify the dashboard query behind “Homeowners” list.
9) Confirm whether it is incorrectly scoped to OpenHouse org/tenant, or applying an inner join that removes units.
10) Fix the query to:
   - scope by the selected tenant/org (Longview Estates)
   - show all residents/units that exist for that tenant
   - use LEFT JOIN where appropriate so missing related rows don’t hide inventory

PHASE 4: Reinstate testing stats and testing material
11) Identify what “testing stats” and “testing material” refers to in the codebase:
   - analytics_events?
   - notices?
   - documents?
   - seeded content for demo/testing?
12) Locate the last known-good seed/data set (pre demo-account work) in the repo or migrations.
13) Reinstate it ONLY under the Longview Estates tenant and the 3 developments:
   - restore notices
   - restore placeholder docs
   - restore any analytics/test events that powered the stats widgets
   - ensure these records are correctly linked by tenant_id/development_id
14) Implement as idempotent seed script (safe to re-run).

PHASE 5: Verification (must be proven with counts, not “looks ok”)
15) Output a “Tenant Integrity Report” in console:
   - Tenants/orgs list (id, name)
   - Developments grouped by tenant (count + names)
   - Units/residents count by development for Longview Estates
   - Document count by development (if relevant)
   - Noticeboard count by development (if relevant)
   - Analytics/testing stats count (if relevant)
16) Manual verification checklist:
   - Dashboard “Homeowners” shows expected count (not 1)
   - Switching scheme/dev shows correct data
   - Purchaser portal for a unit in each estate shows correct intro estate name + correct logo
   - Testing stats/widgets display again

Deliverables
- Idempotent seed/migration scripts created (list paths)
- Code changes to tenant resolution (list files)
- Tenant Integrity Report output
- Confirmation that OH demo org/dev is not used as a default anymore

Start with PHASE 1: identify “Longview Estates” tenant_id and confirm the 3 developments are correctly linked to it. Then fix tenant selection logic so the app is not “looking inside OpenHouse org” by default.
