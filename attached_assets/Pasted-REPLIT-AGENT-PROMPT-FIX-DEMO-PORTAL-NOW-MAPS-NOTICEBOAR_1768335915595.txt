REPLIT AGENT PROMPT (FIX DEMO PORTAL NOW: MAPS + NOTICEBOARD + DOCS + PROFILE BEDS/BATHS, ZERO REGRESSIONS)

Context
Demo seed exists and runs, but:
- Maps still don’t work
- Noticeboard shows 0 posts
- Docs tab shows 0 docs
- Profile needs “3 Bedrooms” and “3 Bathrooms” visible
Demo access code: OH-PARK-009
Hard rule: do not break production tenants, auth, RLS, or existing code paths.

Goal
Make the demo portal fully functional for Apple review with fake data:
1) Maps render and POIs load (Cork City location)
2) Noticeboard shows 3–4 demo posts
3) Docs tab shows 8–10 demo documents and at least 1 opens/downloads
4) Profile displays 3 bedrooms and 3 bathrooms for the demo unit
All via idempotent seed + correct data model usage (no UI hardcoding).

Phase 0: Identify the real data sources (DO THIS FIRST)
1) Find which DB tables the purchaser portal actually reads for:
   - Unit profile fields (beds/baths)
   - Noticeboard posts
   - Documents list
   - Map location (lat/lng) and POI search inputs
2) Confirm whether portal reads from:
   - Supabase Postgres (public schema) via Drizzle
   - Any legacy DB tables
   - Any view or RPC
3) Print the exact table names and columns used by the purchaser portal routes.

DO NOT ASSUME noticeboard_posts exists in the active DB just because code references it.
Use actual queries/routes used by the UI.

Phase 1: Fix Maps (must render and search)
1) Locate the purchaser “places/poi” flow:
   - apps/unified-portal/lib/places/poi.ts (and any related API routes)
   - confirm what it requires (valid coordinates, scheme/unit ids)
2) Ensure demo unit (OH-PARK-009) has valid lat/lng in the exact field the POI code reads.
   - If POI code reads from scheme_profile or unit table, set coords there.
   - Use Cork City coordinates: lat 51.8985, lng -8.4756
3) Ensure NEXT_PUBLIC_GOOGLE_MAPS_API_KEY is wired correctly for the front-end map component:
   - confirm the map component reads NEXT_PUBLIC_GOOGLE_MAPS_API_KEY (not GOOGLE_MAPS_API_KEY)
   - verify script tag loads and map is not blocked by referrer restrictions
4) Add runtime logging (dev only) to show:
   - resolved coordinates used by POI
   - failure_reason if returned empty
5) Verify in preview:
   - map canvas renders
   - a marker shows in Cork
   - a POI search returns results

Phase 2: Fix Noticeboard (3–4 demo posts must appear)
1) Find the exact API route and DB query used by the purchaser noticeboard screen.
   - Determine its table(s). Common possibilities:
     - noticeboard_items
     - notices
     - announcements
     - posts
     - scheme_noticeboard
2) Update seed:demo to insert 4 records into the correct table(s) with correct foreign keys (development_id / scheme_id / project_id / unit_id as required).
3) If noticeboard is behind a feature flag, ensure it’s enabled for purchaser:
   - FEATURE flags already exist; confirm the noticeboard component is enabled.
4) Ensure the noticeboard query filters by tenant/development. Seed must match those IDs.
5) Verify the noticeboard UI shows the posts sorted newest-first.

Use these 4 demo notices:
- “Welcome to OpenHouse Park - Residents Intro Evening”
- “Bins and Recycling - Collection Schedule”
- “Parking and Visitor Bays - Quick Reminder”
- “Local Recommendations - Coffee, Gyms, Schools”

Phase 3: Fix Docs (8–10 demo documents must appear + open)
1) Find the exact API route and DB query used by Docs tab.
   - Identify active table(s), likely:
     - documents
     - unit_documents
     - scheme_documents
     - portal_documents
2) Confirm docs require storage objects:
   - If docs are served from Supabase Storage, seed must upload files to the correct bucket/path.
   - If docs are stored as URLs, seed must populate valid URLs.
3) Implement robust placeholder docs:
   Option A (preferred): generate PDFs locally in seed script and upload to Supabase Storage bucket used by the app.
   Option B: store docs as simple hosted URLs if the app supports it (but must be stable + accessible without auth issues).
4) Insert DB rows for 8–10 docs with correct links/paths and category metadata.
5) Verify the docs tab shows them and at least one opens/downloads in the app without 401.

Doc set to create:
- Homeowner Welcome Pack - OpenHouse Park.pdf
- Floor Plan - Unit 9.pdf
- Appliance Warranty Summary.pdf
- Heating System Quick Start Guide.pdf
- Broadband and Utilities Setup.pdf
- Waste and Recycling Guidelines.pdf
- Fire Safety and Alarms Guide.pdf
- Snagging and Defects Process.pdf
- Resident Handbook - Community Guidelines.pdf

Phase 4: Add 3 Bedrooms / 3 Bathrooms in Profile
1) Identify which table/fields drive the profile display (beds/baths):
   - unit_types?
   - units.bedrooms / units.bathrooms?
   - scheme_units?
2) Update demo unit record in seed:
   - bedrooms = 3
   - bathrooms = 3
3) If UI pulls from a derived “unit_type”, ensure the unit is linked to a unit_type that has 3/3.
4) Verify profile UI renders “3 Bedrooms” and “3 Bathrooms”.

Phase 5: Ensure seed remains idempotent and safe
- All inserts should:
  - upsert by unique keys (tenant slug + development name + unit code)
  - only create missing items
  - update fields if present but wrong (coords, beds/baths)
- Add a final seed summary log:
  - coords set? beds/baths set?
  - docs inserted count
  - notices inserted count

Phase 6: Verify with one clean run
1) Run:
   npm run seed:demo
2) Restart app/dev server if needed
3) Test demo flow:
   - enter OH-PARK-009
   - maps render + POI search works
   - noticeboard shows 4 posts
   - docs show 8–10 items and one opens

Deliverables
- Fixed seed script
- Fixed any incorrect table usage
- Maps rendering confirmed
- Noticeboard populated
- Docs populated
- Profile shows 3 beds / 3 baths

Start now. Do not hand-wave. Locate the real tables/routes first, then wire seed to those exact data sources.
