You are working in the PropertyAssistant monorepo on Replit.

Goal: Fix the **mobile chat layout and spacing** so that:

1. The **chat home screen** looks like the “ideal” screenshot:

   * No vertical scroll on the home screen.
   * The hero content plus the input box and the bottom tab bar all fit perfectly on screen.
   * The text input box always sits directly above the bottom toolbar (never hidden behind it, never a big gap).

2. The **conversation view** behaves like a modern chat app (iMessage / ChatGPT):

   * When a question is asked:

     * The user’s bubble is clearly visible near the top of the visible chat area (just under the top toolbar).
     * The assistant’s reply appears immediately below it.
   * The text input box always remains visible above the bottom toolbar.
   * There is **no huge white gap** between the last message and the input box.
   * The bottom tab bar never overlaps or hides the input.

3. All of this applies **to mobile only** (small breakpoints). Desktop / larger screens should remain as they are.

Do a proper, clean spacing overhaul of the mobile chat layout to achieve this.

---

## CONTEXT / STRUCTURE TO USE

From the repo:

* Unified portal lives under: `apps/unified-portal`.
* Chat routes live under one of:

  * `apps/unified-portal/app/chat`
  * `apps/unified-portal/app/purchaser/chat`
  * or similar purchaser-focused route. Inspect and confirm.
* There is a **MobileTabBar** (bottom navigation) that is fixed at the bottom of the viewport.
* There is an existing chat input component and a chat messages component.

You must make layout changes **only for the purchaser chat UI on mobile**:

* Do NOT change developer dashboards.
* Do NOT change map / docs / noticeboard layout except where they share the same mobile tab bar wrapper.
* Do NOT alter assistant / API logic, only layout & spacing.

---

## TASK 1 – FIND THE RIGHT COMPONENTS

1. Locate:

   * The main purchaser chat page (Next.js page) – likely `app/chat/page.tsx` or under `app/purchaser/chat`.
   * The chat layout shell that wraps the chat, input box, and `MobileTabBar`.
   * The components that render:

     * The hero / home view (logo + quick prompts) when there are **no messages yet**.
     * The conversation view (message bubbles list) when there **are messages**.
     * The input box.
     * The `MobileTabBar`.

2. Document in a code comment somewhere (e.g. in the chat layout file) which components represent:

   * “Home state” (no messages).
   * “Conversation state” (messages list).

---

## TASK 2 – CREATE A DEDICATED MOBILE CHAT LAYOUT

Create or refactor to a dedicated layout component for the **mobile chat screen only**, e.g.:

`apps/unified-portal/components/chat/MobileChatLayout.tsx`

Key requirements:

* Outer container on mobile:

  * `className="flex flex-col h-dvh md:h-auto"`
    (use `h-dvh` or `min-h-[100dvh]` to handle iOS dynamic viewport; fall back gracefully if Tailwind already configured).
  * `overflow-hidden` on mobile so the home screen does not scroll.

* Structure:

```tsx
<div className="flex flex-col h-dvh max-w-screen-sm mx-auto md:h-auto">
  {/* Top header / toolbar */}
  <Header />

  {/* Middle area – scrollable when in conversation, centered when on home */}
  <main className="flex-1 relative">
    {isHome ? (
      <HomeContent />   // hero + quick prompts, centered, no scroll
    ) : (
      <MessagesScrollArea /> // scrollable messages
    )}
  </main>

  {/* Bottom area – input above fixed MobileTabBar */}
  <div className="relative">
    <ChatInputWrapper />   {/* pinned just above tab bar */}
    <MobileTabBar />       {/* fixed to bottom, behind input wrapper */}
  </div>
</div>
```

* Mobile-only behaviour:

  * Use Tailwind responsive classes, e.g. `md:flex-row`, `md:overflow-auto`, etc., to **only enforce this structure on small screens**.
  * Desktop layout should remain unchanged (reuse current layout / CSS at `md:` and above).

Wire this layout into the purchaser chat page only.

---

## TASK 3 – HOME SCREEN LAYOUT (MATCH THE SECOND SCREENSHOT)

For the **home screen** (no messages):

1. Ensure `HomeContent` (logo + heading + 4 quick buttons) is vertically centered between header and input area:

   * Use something like:

   ```tsx
   <div className="flex flex-col items-center text-center h-full px-4 pt-6 pb-24 md:pb-0">
     <div className="flex-1 flex flex-col items-center justify-center gap-4">
       {/* Logo */}
       {/* Heading + subtitle */}
       {/* Quick prompt buttons grid */}
     </div>
   </div>
   ```

2. Important:

   * Do **not** allow the outer container to scroll on mobile when in home state.

   * The input bar + MobileTabBar must **always** be visible:

     * Wrap the input in a container with something like:

       * `className="px-4 pb-safe-bottom"` plus a small `mb-2` gap above the tab bar.
     * Make the MobileTabBar absolute/fixed at bottom:

       ```tsx
       <div className="h-16" /> // spacer equal to tab bar height
       <MobileTabBar className="fixed bottom-0 left-0 right-0 z-20" />
       ```

   * The text input must sit **just above** the tab bar with a small gap (e.g. `mb-1` or `mb-2`), not a large blank area and never hidden behind it.

3. Re-check any padding values that were previously set very large (e.g. `pb-20`, `pb-24`, etc.) and **reduce them on mobile** to get rid of that big white gap seen in the first screenshot. Use something like `pb-16` at most (input + tab bar combined), or better, precise heights using CSS variables.

---

## TASK 4 – CONVERSATION VIEW LAYOUT (THIRD SCREENSHOT FIX)

For the **conversation state** (after the user has sent at least one message):

1. Use a dedicated scroll area:

   ```tsx
   const MessagesScrollArea = () => (
     <div
       ref={scrollContainerRef}
       className="flex-1 overflow-y-auto px-4 pt-3 pb-20"
     >
       {/* message bubbles here */}
     </div>
   );
   ```

   * `flex-1 overflow-y-auto` ensures the messages occupy all space between header and input.
   * `pb-20` (or similar) ensures the last message does not end behind the input bar.

2. Scrolling behaviour when message is sent or received:

   * On send, **scroll the messages container so that the latest user bubble and the assistant reply are visible directly under the header**.
   * Implement with `scrollContainerRef.current.scrollTo({ top: 0, behavior: 'smooth' })` if you render messages in reverse order, OR `scrollTo({ top: scrollHeight })` if you render top-to-bottom. Use whichever direction is already implemented, but fix it so that:

     * The user’s most recent bubble is not hidden above the visible area.
     * The assistant’s answer appears immediately adjacent, no need for manual scrolling.

   Make this logic **mobile only** by guarding with a `useIsMobile()` hook or `window.innerWidth` check if such a hook already exists. On desktop, keep existing scroll behaviour.

3. Ensure the input bar is **always above the tab bar**:

   * Input wrapper:

   ```tsx
   <div className="relative z-30 bg-background">
     <div className="px-4 pt-2 pb-3 border-t">
       <ChatInput ... />
     </div>
     <div className="h-14" /> {/* spacer equal to MobileTabBar height */}
   </div>
   ```

   * MobileTabBar stays `fixed bottom-0 left-0 right-0 z-20`.
   * Remove any conflicting `pb-*` padding on parent containers that push the input too far above the tab bar; just use the spacer approach above so there is **a tight, consistent gap** between input and toolbar, not a huge one.

4. Remove / refactor any previous layout hacks added by the Agent (excessive bottom padding, redundant wrappers, fragments leaking flex layout etc.) that caused:

   * Big vertical gaps.
   * Input sliding behind the tab bar.
   * Messages being pushed off-screen.

The final behaviour should feel like iMessage / ChatGPT on mobile:

* Header at top, messages scroll nicely, input always anchored above the navigation bar, no weird gaps.

---

## TASK 5 – MOBILE-ONLY RESPONSIVE RULES

All the above adjustments must be **scoped to mobile**:

* Use Tailwind responsive classes:

  * For example:

    * `h-dvh md:h-full`
    * `overflow-hidden md:overflow-auto`
    * `fixed bottom-0 ... md:static`
  * Do not change layout at `md:` and above – the desktop/tablet chat should behave as before.

* If you need to introduce CSS variables for safe area (iOS), add them to the global stylesheet (e.g. `globals.css`) and use utility classes like `pb-safe` or custom `padding-bottom: env(safe-area-inset-bottom)` only on mobile.

---

## TASK 6 – VERIFY ON MOBILE PREVIEW

Use the Replit mobile preview / responsive dev tools to verify:

1. **Home screen:**

   * No scroll.
   * Input bar visible and just above tab bar.
   * No huge white gap.
   * Layout matches the “ideal” screenshot as closely as possible.

2. **After sending a message:**

   * The user bubble appears clearly under the top toolbar (not off-screen).
   * The assistant message is visible as it streams.
   * Input bar remains visible and not obstructed by the bottom toolbar.
   * Scrolling feels natural and smooth.

3. Confirm no regressions on:

   * Desktop chat.
   * Map / News / Docs tabs.
   * Purchaser navigation in general.

When finished, summarise in comments in the relevant layout file what you changed and why (mobile-only chat spacing overhaul).
