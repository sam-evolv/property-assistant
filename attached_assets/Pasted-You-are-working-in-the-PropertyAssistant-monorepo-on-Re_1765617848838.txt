You are working in the PropertyAssistant monorepo on Replit.

Objective: Fix the **mobile** chat layout in `PurchaserChatTab.tsx` so that:
- The **home screen** (no messages) is a fixed, non-scrollable layout that matches the branded hero + quick buttons exactly as in the original design.
- The **input bar + disclaimer** always sit directly above the bottom tab bar (Chat / Map / News / Docs) with **no extra white gap**.
- The **disclaimer text is never clipped** by the bottom toolbar.
- When the keyboard opens, the input bar stays immediately above the tab bar (with only the disclaimer gap) and there is no extra white padding.
- When a message is sent, the conversation view behaves like ChatGPT:
  - The first question bubble appears clearly at the top of the chat area (just under the top header), not hidden off-screen.
  - The messages area scrolls, not the whole page.
- These changes apply **only on mobile** (small screens). Desktop / tablet layouts must not be changed.

Very important: Previous attempts have over-complicated things and broken spacing. This time, please:
- Work ONLY in `apps/unified-portal/components/purchaser/PurchaserChatTab.tsx`.
- Do NOT change any other components, layouts, or global CSS.
- Do NOT change the bottom tab bar component at all.
- Keep the overall visual spacing of the **first screenshot** as the ground truth for the home screen.

------------------------------------------------------------------
STEP 1 – Restore a clean baseline of PurchaserChatTab
------------------------------------------------------------------
1. In the Git panel, open the parent commit of `caa2380` (`Adjust chat screen layout to ensure visibility above bottom toolbar`) – hash is `a20abc7`.
2. Inspect `apps/unified-portal/components/purchaser/PurchaserChatTab.tsx` in that commit.
3. Restore the structure and classes of `PurchaserChatTab.tsx` to match that earlier version as closely as possible (either by copying from the old commit or by removing any “dynamic height / bottom toolbar / safe area inset” hacks introduced in `caa2380`).
4. Re-run the dev server and confirm that:
   - The home screen looks visually like the first screenshot again.
   - The bottom tab bar and the input line look as they did originally (before the dynamic height changes), even if there is still some padding/scrolling to fix.

This gives us a known, stable baseline.

------------------------------------------------------------------
STEP 2 – Explicit mobile-only layout structure
------------------------------------------------------------------
Now refactor `PurchaserChatTab.tsx` layout **in place**, but keep behaviour identical on desktop.

1. Ensure the root of the chat tab is a flex column container:

   - Wrap the content of `PurchaserChatTab` in a root element like:
     ```tsx
     <div className="flex h-full flex-col">
       {/* header/hero/chat area */}
       {/* input + disclaimer */}
     </div>
     ```
   - This root container should NOT have `overflow-y-auto` on it. Only inner areas should scroll.

2. Split the content into two explicit sections:
   - `contentArea` – the hero + quick buttons OR the messages list.
   - `inputArea` – the input bar and disclaimer.

   Both should be direct children of the root flex container:

   ```tsx
   <div className="flex h-full flex-col">
     <div className="flex-1">
       {showHome ? <HomeView /> : <MessagesView />}
     </div>
     <div className="shrink-0">
       <InputBarWithDisclaimer />
     </div>
   </div>
Wrap these with mobile-only classes:

On the root container add:

md:h-auto so desktop behaves normally.

For mobile: h-[100dvh] to anchor to the viewport height (not min-h-screen).
Example:

tsx
Copy code
<div className="flex h-[100dvh] flex-col md:h-full">
STEP 3 – Home screen (no messages) behaviour
For the home state (showHome && messages.length === 0):

The hero / quick buttons container should:

Be vertically centered within the content area.

NOT be scrollable on mobile.

Implement like:

tsx
Copy code
const HomeView = () => (
  <div className="flex h-full flex-col items-center justify-center px-4 md:overflow-y-auto md:justify-start md:pt-8">
    {/* Longview logo, heading, subheading, quick buttons */}
  </div>
);
Key points:

On mobile: h-full + no overflow-y-* (so no scrolling).

On desktop: md:overflow-y-auto is allowed if already there.

Confirm on your phone:

You cannot scroll the home screen at all.

The input bar + disclaimer sit exactly above the tab bar with no clipping and no extra white padding.

Do NOT change the actual visual spacing of the hero; the goal is simply to lock this screen.

STEP 4 – Conversation view behaviour
For the conversation state (any messages present):

Define the messages container so that only this area scrolls:

tsx
Copy code
const MessagesView = () => (
  <div className="flex h-full flex-col">
    <div
      ref={messagesContainerRef}
      className="flex-1 overflow-y-auto px-4 pt-3 pb-2"
    >
      {/* messages mapped in normal order, not flex-col-reverse */}
    </div>
  </div>
);
Requirements:

flex-1 overflow-y-auto on the messages container.

No extra padding/margin on the bottom that would push the content upward.

Do NOT put overflow-y-auto on the root container.

Ensure messages are rendered in normal order (flex-col) and not flex-col-reverse. If you currently use flex-col-reverse, remove it and rely on scrolling.

Add an effect to always scroll to the bottom when messages change:

tsx
Copy code
const messagesEndRef = useRef<HTMLDivElement | null>(null);

useEffect(() => {
  if (messagesEndRef.current) {
    messagesEndRef.current.scrollIntoView({ behavior: 'smooth', block: 'end' });
  }
}, [messages.length]);
And at the end of the message list:

tsx
Copy code
<div ref={messagesEndRef} />
This ensures that when you send a question, the new bubble stays visible just under the top header and the conversation behaves like ChatGPT.

STEP 5 – Input bar + disclaimer spacing (critical part)
The input area must:

Always sit above the bottom tab bar.

Never be hidden or overlapped by it.

Have no extra white gap beyond the disclaimer text.

Implement the input wrapper like this:

tsx
Copy code
const InputBarWithDisclaimer = () => (
  <div className="bg-white px-4 pt-2 pb-[env(safe-area-inset-bottom)] md:pb-0">
    <div className="flex items-center gap-2 rounded-full border border-gray-200 bg-[#F5F6F8] px-4 py-2">
      {/* home icon / text input / mic, etc. */}
    </div>
    <p className="mt-1 text-center text-[10px] leading-tight text-gray-400">
      Powered by AI • Information provided for reference only
    </p>
  </div>
);
Adjustments:

Remove ANY mb-*, pb-*, or pt-* classes that add extra space below the disclaimer or below this wrapper on mobile. The only vertical space between the input bar and the tab bar should be:

The height of the disclaimer text.

The browser’s safe area inset, handled via pb-[env(safe-area-inset-bottom)].

If there is any parent container in PurchaserChatTab that still has bottom padding/margin specifically for mobile (e.g. pb-4, mb-4, space-y-*), remove those on mobile:

Either remove them completely, or wrap them in md:pb-4 so they apply only on larger screens.

The goal is that on mobile you see:

Tab bar

Directly above it: disclaimer text

Directly above disclaimer: rounded input

With no extra blank white area.

Do NOT shrink the disclaimer or input excessively. Just remove the padding/margin that causes the “big stupid white area”.

STEP 6 – Keyboard interaction on mobile
We want the keyboard to push the input area up but keep the relationship between tab bar, disclaimer and input intact.

Confirm that there is no fixed positioning on the input wrapper for mobile (no fixed bottom-0). It should be part of the flex column and simply sit at the bottom of the viewport because of h-[100dvh] on the root and flex-col with flex-1 on content.

If you are using a useWindowHeight / safe area hook introduced in previous attempts, remove it. It has been the main source of unpredictable gaps. For this pass, rely on:

h-[100dvh] on the root.

flex-1 overflow-y-auto on messages.

pb-[env(safe-area-inset-bottom)] on the input wrapper.

Test on a real mobile viewport in Replit (and ideally on device):

Initial home screen: matches first screenshot, no scroll.

Tap into the text field on home screen:

Keyboard appears.

Tab bar stays visible.

Between tab bar and text box you see only the disclaimer text, no extra white gap.

Ask a question:

After sending, the chat switches to conversation view.

The question bubble and answer are visible at the top of the chat area (not hidden above).

When you reply again:

Keyboard appears.

Tab bar, disclaimer and input remain tightly stacked, with no new white area introduced.

STEP 7 – Regression checks
Before finishing:

Verify that desktop view of the purchaser chat tab has not changed:

Home screen still scrolls if it did before.

Spacing still looks acceptable.

Verify that Map / News / Docs tabs are unaffected.

Confirm no TypeScript or ESLint errors.

Finally, summarise in the Replit log:

What you changed in PurchaserChatTab.tsx (structure and key class changes).

How the home screen and conversation screen now behave on mobile.

Any remaining assumptions or limitations.

Do not touch any other files.

makefile
Copy code
::contentReference[oaicite:0]{index=0}